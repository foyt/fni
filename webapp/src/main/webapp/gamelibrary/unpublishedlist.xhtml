<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:ui="http://java.sun.com/jsf/facelets" 
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" 
  template="/WEB-INF/templates/gamelibrary_publications.xhtml">
  
  <ui:define name="headExtra">
    <!-- jQuery File Upload -->

    <h:outputScript name="scripts/load-image/load-image.min.js"/>
    <h:outputScript name="scripts/canvas-to-blob/canvas-to-blob.min.js"/>
    
    <script type="text/javascript" src="http://cdn.jsdelivr.net/jquery.fileupload/8.5.0/js/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/jquery.fileupload/8.5.0/js/jquery.fileupload.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/jquery.fileupload/8.5.0/js/jquery.fileupload-process.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/jquery.fileupload/8.5.0/js/jquery.fileupload-image.js"></script>
    
    <h:outputScript name="scripts/gui/gamelibrary/unpublishedlist.js"></h:outputScript>
  </ui:define>

  <ui:define name="publications">
    <h:form>
      <h:panelGroup layout="block" id="gamelibrary-index" styleClass="gamelibrary-index">
        <div class="gamelibrary-publications">
          <h3 class="gamelibrary-publications-title">
            <span class="gamelibrary-nav-item">
              <h:outputLink value="#{request.contextPath}/gamelibrary/">
                #{locales['gamelibrary.unpublishedList.navIndex']} 
              </h:outputLink>
            </span>
            <span class="gamelibrary-nav-separator"/>
            <span class="gamelibrary-nav-item">
              #{locales['gamelibrary.unpublishedList.navUnpublished']} 
            </span>
          </h3>
          
          <div class="gamelibrary-publications">
            <ui:repeat var="publication" value="#{publicationUnpublishedListBackingBean.publications}">
              <div data-publication-id="#{publication.id}" class="gamelibrary-publication">
                <div class="gamelibrary-publication-info-container">
                  <div class="gamelibrary-publication-name">
                    <h:outputLink value="#{request.contextPath}/gamelibrary/#{publication.urlName}">#{publication.name}</h:outputLink>
                  </div>
                  <div class="gamelibrary-publication-tags-container">
                    <ui:repeat var="tag" value="#{publicationUnpublishedListBackingBean.getTags(publication)}">
                      <div class="gamelibrary-publication-tag">
                        <h:outputLink value="#{request.contextPath}/gamelibrary/tags/#{tag.text}">#{tag.text}</h:outputLink>
                      </div>
                    </ui:repeat>
                  </div>
                  
                  <div class="gamelibrary-publication-description">#{publication.description}</div>
                  
                  <h:panelGroup layout="block" styleClass="gamelibrary-publication-license-container">
                    <ui:fragment rendered="#{publicationUnpublishedListBackingBean.getCreativeCommonsLicense(publication) ne null}">
                      <h:outputLink value="#{publicationUnpublishedListBackingBean.getCreativeCommonsLicense(publication).url}">
                        <h:graphicImage value="#{publicationUnpublishedListBackingBean.getCreativeCommonsLicense(publication).iconUrl}" />
                      </h:outputLink>
                    </ui:fragment>
                    
                    <ui:fragment rendered="#{publicationUnpublishedListBackingBean.getCreativeCommonsLicense(publication) eq null}">
                      <label>#{locales['gamelibrary.unpublishedList.publicationLicenseOther']}</label>
                      <div>#{publication.license}</div>
                    </ui:fragment>
                  </h:panelGroup>
                                  
                  <div class="gamelibrary-publication-details">
                    <div class="gamelibrary-publication-detail">
                      <span>#{locales['gamelibrary.unpublishedList.publicationDetailsPrice']}</span>
                      <span class="gamelibrary-publication-details-price">
                        <h:outputText value="#{publication.price}" >
                          <f:convertNumber currencyCode="EUR" type="currency" />
                        </h:outputText>
                      </span>
                    </div>
                    
                    <ui:fragment rendered="#{publicationUnpublishedListBackingBean.getBookPublication(publication) ne null}">
                      <ui:fragment rendered="#{publicationUnpublishedListBackingBean.getBookPublication(publication).numberOfPages > 0}">
                        <div class="gamelibrary-publication-detail">
                          <span>#{locales['gamelibrary.unpublishedList.publicationDetailsNumberOfPages']}</span> 
                          <span>#{publicationUnpublishedListBackingBean.getBookPublication(publication).numberOfPages}</span>
                        </div>
                      </ui:fragment>
                      
                      <ui:fragment rendered="#{publicationUnpublishedListBackingBean.getAuthors(publication).size() > 0}">
                        <div class="gamelibrary-publication-detail">
                        <span>#{locales['gamelibrary.unpublishedList.publicationDetailsAuthors']}</span> 
                        <span>
                          <ui:repeat var="author" value="#{publicationUnpublishedListBackingBean.getAuthors(publication)}">
                            <h:outputLink value="#{request.contextPath}/users/#{author.id}">
                              #{author.fullName}
                            </h:outputLink>
                          </ui:repeat>
                        </span>
                        </div>
                      </ui:fragment>
                    </ui:fragment>
                    
                    <h:panelGroup layout="block" rendered="#{publication.forumTopic ne null}" styleClass="gamelibrary-publication-comments">
                      <h:outputLink value="#{request.contextPath}/forum/#{publication.forumTopic.forum.urlName}/#{publication.forumTopic.urlName}">
                        <h:outputFormat value="#{locales['gamelibrary.unpublishedList.publicationComments']}">
                          <f:param value="#{publicationUnpublishedListBackingBean.getPublicationCommentCount(publication)}"/>
                        </h:outputFormat>                    
                      </h:outputLink>
                    </h:panelGroup>
                  </div>
                  
                  <div class="gamelibrary-publication-admin-actions-container">
                    <div class="gamelibrary-publication-admin-action-container">
                      <a class="publication-publish" data-publication-id="#{publication.id}" data-publication-name="#{publication.name}" href="javascript:void(null);" title="#{locales['gamelibrary.unpublishedList.actionsPublish']}"></a>
                      <h:commandButton action="#{publicationUnpublishedListBackingBean.publish(publication.id)}" style="display:none"/>
                    </div>
                    <div class="gamelibrary-publication-admin-action-container">
                      <a class="publication-edit" data-publication-id="#{publication.id}" href="javascript:void(null);" title="#{locales['gamelibrary.unpublishedList.actionsEdit']}"></a>
                    </div>
                    <div class="gamelibrary-publication-admin-action-container">
                      <a class="publication-add-images-action" data-publication-id="#{publication.id}" href="javascript:void(null);" title="#{locales['gamelibrary.unpublishedList.actionsAddImages']}"></a>
                    </div>
                    <div class="gamelibrary-publication-admin-action-container">
                      <a class="publication-delete" data-publication-id="#{publication.id}" data-publication-name="#{publication.name}" href="javascript:void(null);" title="#{locales['gamelibrary.unpublishedList.actionsDelete']}"></a>
                      <h:commandButton action="#{publicationUnpublishedListBackingBean.delete(publication.id)}" style="display:none"/>
                    </div>
                  </div>
                </div>
                
                <div class="gamelibrary-publication-images-container">
                  <ui:fragment rendered="#{publicationUnpublishedListBackingBean.hasSeveralImages(publication)}">
                    <div class="gamelibrary-publication-thumbnails-container">
                      <div class="gamelibrary-publication-thumbnails-inner-container">
                        <ui:repeat value="#{publicationUnpublishedListBackingBean.getPublicationImages(publication)}" var="publicationImage">
                          <div class="gamelibrary-publication-thumbnail-container">
                            <a href="javascript:void(null)">
                              <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{publicationImage.id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{publicationImage.id}?width=32&amp;height=32"/>
                            </a>
                          </div>
                        </ui:repeat>
                      </div>
                    </div>
                  </ui:fragment>
  
                  <ui:fragment rendered="#{publicationUnpublishedListBackingBean.hasImages(publication)}">
                    <div class="gamelibrary-publication-image-container">
                      <div class="gamelibrary-publication-image-inner-container">
                        <a href="#{request.contextPath}/gamelibrary/publicationImages/#{publication.defaultImage.id}">
                          <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{publication.defaultImage.id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{publication.defaultImage.id}?width=128&amp;height=128"/>
                        </a>
                      </div>
                    </div>
                  </ui:fragment>
                </div>
                
                <div class="gamelibrary-publication-actions-container">
                  <div class="gamelibrary-publication-action-container">
                    <a href="#{request.contextPath}/gamelibrary/publicationFiles/#{publication.id}">#{locales['gamelibrary.unpublishedList.publicationDownloadFreePdf']}</a>
                  </div>
                  <div class="gamelibrary-publication-action-container">
                    <h:commandLink action="#{publicationUnpublishedListBackingBean.addPublicationToShoppingCart(publication)}" value="#{locales['gamelibrary.unpublishedList.publicationAddToShoppingCart']}" styleClass="gamelibrary-publication-add-to-cart-action"/>
                  </div>
                </div>
                
                <div class="clearFloating"></div>
              </div>
            </ui:repeat>
          </div>
        </div>
      </h:panelGroup>
    </h:form>
  </ui:define>
  
  <ui:define name="adminPanel">
  
    <!-- TODO: Game Library Admins only -->
          
    <div id="gamelibrary-admin-panel">
      <a class="gamelibrary-admin-create-publication" title="Create New Publication"> </a>
    </div>
  </ui:define>
    
</ui:composition>
    
    