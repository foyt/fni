<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:ui="http://java.sun.com/jsf/facelets" 
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" 
  template="/WEB-INF/templates/gamelibrary_publications.xhtml">

  <ui:define name="publications">
    <h:form>
      <h:panelGroup layout="block" id="gamelibrary-index" styleClass="gamelibrary-index">
        <div class="gamelibrary-publications">
          <h3 class="gamelibrary-publications-title">
            <span class="gamelibrary-nav-item">
              <h:outputLink value="#{request.contextPath}/gamelibrary/">
                #{locales['gamelibrary.publicationDetails.navIndex']} 
              </h:outputLink>
            </span>            
            <span class="gamelibrary-nav-separator"/>
            <span class="gamelibrary-nav-item">#{publicationDetailsBackingBean.publication.name}</span>
          </h3>
          
          <div>
            <div data-publication-id="#{publicationDetailsBackingBean.publication.id}" class="gamelibrary-publication">
              <div class="gamelibrary-publication-info-container">
                <div class="gamelibrary-publication-name">#{publicationDetailsBackingBean.publication.name}</div>
                <div class="gamelibrary-publication-tags-container">
                  <ui:repeat var="tag" value="#{publicationDetailsBackingBean.tags}">
                    <div class="gamelibrary-publication-tag">
                      <h:outputLink value="#{request.contextPath}/gamelibrary/tags/#{tag.text}">#{tag.text}</h:outputLink>
                    </div>
                  </ui:repeat>
                </div>
                
                <div class="gamelibrary-publication-description">#{publicationDetailsBackingBean.publication.description}</div>
                <h:panelGroup layout="block" styleClass="gamelibrary-publication-license-container">
                  <ui:fragment rendered="#{publicationDetailsBackingBean.creativeCommonsLicense ne null}">
                    <h:outputLink value="#{publicationDetailsBackingBean.creativeCommonsLicense.url}">
                      <h:graphicImage value="#{publicationDetailsBackingBean.creativeCommonsLicense.iconUrl}" />
                    </h:outputLink>
                  </ui:fragment>
                  
                  <ui:fragment rendered="#{publicationDetailsBackingBean.creativeCommonsLicense eq null}">
                    <label>#{locales['gamelibrary.publicationDetails.publicationLicenseOther']}</label>
                    <div>#{publicationDetailsBackingBean.publication.license}</div>
                  </ui:fragment>
                </h:panelGroup>
                <div class="gamelibrary-publication-details">
                  <div class="gamelibrary-publication-detail">
                    <span>#{locales['gamelibrary.publicationDetails.publicationDetailsPrice']}</span>
                    <span class="gamelibrary-publication-details-price">
                      <h:outputText value="#{publicationDetailsBackingBean.publication.price}" >
                        <f:convertNumber currencyCode="EUR" type="currency" />
                      </h:outputText>
                    </span>
                  </div>
                  <ui:fragment rendered="#{publicationDetailsBackingBean.bookPublication ne null}">
                    <ui:fragment rendered="#{publicationDetailsBackingBean.bookPublication.numberOfPages > 0}">
                      <div class="gamelibrary-publication-detail">
                        <span>#{locales['gamelibrary.publicationDetails.publicationDetailsNumberOfPages']}</span> 
                        <span>#{publicationDetailsBackingBean.bookPublication.numberOfPages}</span>
                      </div>
                    </ui:fragment>
                  </ui:fragment>
                  <ui:fragment rendered="#{publicationDetailsBackingBean.bookPublication ne null}">
                    <ui:fragment rendered="#{!empty(publicationDetailsBackingBean.bookPublication.author)}">
                      <span>#{locales['gamelibrary.publicationDetails.publicationDetailsPrice']}</span> 
                      <span>#{publicationDetailsBackingBean.bookPublication.author}</span>
                    </ui:fragment>
                  </ui:fragment>
                  
                  <h:panelGroup layout="block" rendered="#{publicationDetailsBackingBean.publication.forumTopic ne null}" styleClass="gamelibrary-publication-comments">
                    <h:outputLink value="#{request.contextPath}/forum/#{publicationDetailsBackingBean.publication.forumTopic.forum.urlName}/#{publicationDetailsBackingBean.publication.forumTopic.urlName}">
                      <h:outputFormat value="#{locales['gamelibrary.tagList.publicationComments']}">
                        <f:param value="#{publicationDetailsBackingBean.publicationCommentCount}"/>
                      </h:outputFormat>                          
                    </h:outputLink>
                  </h:panelGroup>
                </div>
                
                <ui:fragment rendered="#{publicationDetailsBackingBean.publication.published}">
                  <!-- TODO: Admins and owners only -->
                  <div class="gamelibrary-publication-admin-actions-container">
                    <div class="gamelibrary-publication-admin-action-container">
                      <a title="Unpublish Publication" href="javascript:void(null);" data-publication-id="#{publicationDetailsBackingBean.publication.id}" data-publication-name="#{publicationDetailsBackingBean.publication.name}" class="publication-unpublish"></a>
                    </div>
                  </div>
                </ui:fragment>
                
              </div>
              
              <div class="gamelibrary-publication-images-container">
                <ui:fragment rendered="#{publicationDetailsBackingBean.hasSeveralImages}">
                  <div class="gamelibrary-publication-thumbnails-container">
                    <div class="gamelibrary-publication-thumbnails-inner-container">
                      <ui:repeat value="#{publicationDetailsBackingBean.publicationImages}" var="publicationImage">
                        <div class="gamelibrary-publication-thumbnail-container">
                          <a href="javascript:void(null)">
                            <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{publicationImage.id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{publicationImage.id}?width=32&amp;height=32"/>
                          </a>
                        </div>
                      </ui:repeat>
                    </div>
                  </div>
                </ui:fragment>

                <ui:fragment rendered="#{publicationDetailsBackingBean.hasImages}">
                  <div class="gamelibrary-publication-image-container">
                    <div class="gamelibrary-publication-image-inner-container">
                      <a href="#{request.contextPath}/gamelibrary/publicationImages/#{publicationDetailsBackingBean.firstImage.id}">
                        <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{publicationDetailsBackingBean.firstImage.id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{publicationDetailsBackingBean.firstImage.id}?width=128&amp;height=128"/>
                      </a>
                    </div>
                  </div>
                </ui:fragment>
              </div>
              
              <div class="gamelibrary-publication-actions-container">
                <div class="gamelibrary-publication-action-container">
                  <a href="#{request.contextPath}/gamelibrary/publicationFiles/#{publicationDetailsBackingBean.publication.id}">#{locales['gamelibrary.publicationDetails.publicationDownloadFreePdf']}</a>
                </div>
                <div class="gamelibrary-publication-action-container">
                  <h:commandLink action="#{publicationDetailsBackingBean.addPublicationToShoppingCart}" value="#{locales['gamelibrary.publicationDetails.publicationAddToShoppingCart']}" styleClass="gamelibrary-publication-add-to-cart-action">
                  </h:commandLink>
                </div>
              </div>
              
              <div class="clearFloating"></div>
            </div>
          </div>
        </div>
      </h:panelGroup>
    </h:form>
  </ui:define>  
</ui:composition>
    
    