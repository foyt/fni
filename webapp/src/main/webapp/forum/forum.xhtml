<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:ui="http://java.sun.com/jsf/facelets" 
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" 
  template="/WEB-INF/templates/forum.xhtml">

  <ui:define name="pageTitle">#{locales['forum.forum.pageTitle']}</ui:define>
  <ui:define name="head">
    <!-- CKEditor -->
    
    <script type="text/javascript" charset="utf8" src="http://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.2/ckeditor.js"></script>
    
    <!-- View Specific -->

    <h:outputScript name="scripts/gui/forum/ckconfig.js"></h:outputScript>
    <h:outputScript name="scripts/gui/forum/forum.js"></h:outputScript>
    <link rel="StyleSheet" type="text/css" href="#{request.contextPath}/themes/novus/css/forum.css"/>
    
  </ui:define>
  <ui:define name="content">
    <h:form>
      <h:panelGroup layout="block" id="forum" styleClass="forum">
        <h3>
          <span class="forum-nav-item"><h:outputLink value="#{request.contextPath}/forum/">#{locales['forum.forum.navItemForum']}</h:outputLink></span>
          <span class="forum-nav-separator"/>
          <span class="forum-nav-item">#{forumBackingBean.forum.name}</span>
        </h3>

        <div class="forum-container">
          <div class="forum-topics">
            <ui:repeat var="topic" value="#{forumBackingBean.topics}">
              <div class="forum-topic">
                <div class="forum-topic-subject">
                  <h:outputLink value="#{forumBackingBean.forum.urlName}/#{topic.urlName}">#{topic.subject}</h:outputLink>
                  <div class="forum-topic-message-count-container">
                    <span class="forum-topic-message-count">
                      <h:outputFormat value="#{locales['forum.forum.totalPosts']}">
                        <f:param value="#{forumBackingBean.getTopicPostCount(topic)}"/>
                      </h:outputFormat>
                    </span>
                  </div>
                  <div class="forum-topic-last-message-container">
                    <h:panelGroup styleClass="forum-topic-last-message">
                      <h:outputFormat value="#{locales['forum.forum.lastPost']}">
                        <f:param value="#{forumBackingBean.getLastMessageDate(topic)}"/>
                      </h:outputFormat>
                    </h:panelGroup>
                  </div>                
                </div>
                
                <div class="forum-topic-author">
                  <span>
                    <h:outputFormat value="#{locales['forum.forum.topicStartedBy']}">
                      <f:param value="#{topic.author.fullName}"/>
                    </h:outputFormat>
                  </span>
                </div>
                <div class="forum-topic-created">
                  <span>
                    <h:outputFormat value="#{locales['forum.forum.topicCreatedAt']}">
                      <f:param value="#{topic.created}"/>
                    </h:outputFormat>
                  </span>
                </div>
              </div>
            </ui:repeat>
          </div>
        </div>   
        
        <h:panelGroup rendered="#{forumBackingBean.allowTopicCreation}">
          <h:panelGroup layout="block" styleClass="forum-new-topic-container" rendered="#{sessionBackingBean.loggedIn}">
            <div class="forum-new-topic-editor-container" style="display: none">
              <div>
                <h:outputLabel value="#{locales['forum.forum.newTopicSubjectLabel']}" />
              </div>
              <div>
                <h:inputText required="required" class="forum-new-topic-subject" value="#{forumBackingBean.newTopicSubject}" />
              </div>
              <div>
                <h:outputLabel value="#{locales['forum.forum.newTopicContentLabel']}" />
              </div>
              <div>
                <h:inputTextarea class="forum-topic-contents-editor" value="#{forumBackingBean.newTopicContents}" />
              </div>
              <div>
                <h:commandButton  class="forum-new-topic-button" value="#{locales['forum.forum.newTopicButton']}" action="#{forumBackingBean.newTopic}" />
              </div>
            </div>
            
            <a href="javascript:void(null)" class="forum-new-topic-link">#{locales['forum.forum.newTopicLink']}</a>
          </h:panelGroup>
          
          <h:panelGroup layout="block" styleClass="forum-new-topic-login-container" rendered="#{!sessionBackingBean.loggedIn}">
            <h:outputLink styleClass="forum-new-topic-login-link" value="#{request.contextPath}/login?redirectUrl=#{request.contextPath}/forum/#{forumBackingBean.forum.urlName}">#{locales['forum.forum.newTopicLoginRequired']}</h:outputLink>
          </h:panelGroup>
        </h:panelGroup>

      </h:panelGroup>
    </h:form>    
  </ui:define>

</ui:composition>
